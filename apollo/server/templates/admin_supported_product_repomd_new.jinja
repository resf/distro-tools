{% extends "admin_layout.jinja" %}

{% block admin_content %}
<div class="bx--grid">
    <div class="bx--row">
      <div class="bx--col">
        <nav aria-label="breadcrumb" class="bx--breadcrumb">
          <div class="bx--breadcrumb-item">
            <a href="/admin/supported-products/" class="bx--link">Supported Products</a>
          </div>
          <div class="bx--breadcrumb-item">
            <a href="/admin/supported-products/{{ mirror.supported_product.id }}" class="bx--link">{{ mirror.supported_product.name }}</a>
          </div>
          <div class="bx--breadcrumb-item">
            <a href="/admin/supported-products/{{ mirror.supported_product.id }}/mirrors/{{ mirror.id }}" class="bx--link">{{ mirror.name }}</a>
          </div>
          <div class="bx--breadcrumb-item bx--breadcrumb-item--current">
            <span>New Repository</span>
          </div>
        </nav>

        <h1 class="bx--type-expressive-heading-05">Add Repository Configuration</h1>
        <p class="bx--type-body-long-02">Create a new repository configuration for {{ mirror.name }}.</p>
      </div>
    </div>

    {% if error %}
    <div class="bx--row">
      <div class="bx--col">
        <div class="bx--inline-notification bx--inline-notification--error" role="alert">
          <div class="bx--inline-notification__details">
            <div class="bx--inline-notification__text-wrapper">
              <div class="bx--inline-notification__title">Error</div>
              <div class="bx--inline-notification__subtitle">{{ error }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="bx--row">
      <div class="bx--col-lg-8">
        <form method="post" class="bx--form">
          <div class="bx--form-item">
            <label for="repo_name" class="bx--label">Repository Name *</label>
            <input id="repo_name" name="repo_name" type="text" class="bx--text-input"
                   required maxlength="255"
                   value="{{ form_data.repo_name if form_data else '' }}"
                   placeholder="e.g., BaseOS, AppStream, CRB">
            <div class="bx--form__helper-text">
              The name of the repository (e.g., BaseOS, AppStream, CRB)
            </div>
          </div>

          <div class="bx--form-item">
            <label for="arch" class="bx--label">Architecture *</label>
            <select id="arch" name="arch" class="bx--select-input" required>
              <option value="">Select architecture</option>
              <option value="x86_64" {% if form_data and form_data.arch == 'x86_64' %}selected{% endif %}>x86_64</option>
              <option value="aarch64" {% if form_data and form_data.arch == 'aarch64' %}selected{% endif %}>aarch64</option>
              <option value="ppc64le" {% if form_data and form_data.arch == 'ppc64le' %}selected{% endif %}>ppc64le</option>
              <option value="s390x" {% if form_data and form_data.arch == 's390x' %}selected{% endif %}>s390x</option>
            </select>
            <div class="bx--form__helper-text">
              The target architecture for this repository
            </div>
          </div>

          <div class="bx--form-item">
            <fieldset class="bx--fieldset">
              <legend class="bx--label">Environment *</legend>
              <div class="bx--form-item bx--checkbox-wrapper">
                <input type="hidden" name="production" value="false">
                <input id="production" name="production" type="checkbox" class="bx--checkbox"
                       value="true" {% if form_data and form_data.production %}checked{% endif %}>
                <label for="production" class="bx--checkbox-label">
                  <span class="bx--checkbox-label-text">Production</span>
                </label>
              </div>
            </fieldset>
            <div class="bx--form__helper-text">
              Check if this is a production repository
            </div>
          </div>

          <div class="bx--form-item">
            <label for="url" class="bx--label">Repository URL *</label>
            <input id="url" name="url" type="url" class="bx--text-input"
                   required value="{{ form_data.url if form_data else '' }}"
                   placeholder="https://example.com/repo/repodata/repomd.xml">
            <div class="bx--form__helper-text">
              Full URL to the repository metadata (repomd.xml)
            </div>
          </div>

          <div class="bx--form-item">
            <label for="debug_url" class="bx--label">Debug Repository URL</label>
            <input id="debug_url" name="debug_url" type="url" class="bx--text-input"
                   value="{{ form_data.debug_url if form_data else '' }}"
                   placeholder="https://example.com/debug/repo/repodata/repomd.xml">
            <div class="bx--form__helper-text">
              URL to the debug repository (optional)
            </div>
          </div>

          <div class="bx--form-item">
            <label for="source_url" class="bx--label">Source Repository URL</label>
            <input id="source_url" name="source_url" type="url" class="bx--text-input"
                   value="{{ form_data.source_url if form_data else '' }}"
                   placeholder="https://example.com/source/repo/repodata/repomd.xml">
            <div class="bx--form__helper-text">
              URL to the source repository (optional)
            </div>
          </div>

          <div class="apollo-form-actions-inline apollo-mt-3">
            <button type="submit" class="bx--btn bx--btn--primary">
              Create Repository
            </button>
            <a href="/admin/supported-products/{{ mirror.supported_product.id }}/mirrors/{{ mirror.id }}"
               class="bx--btn bx--btn--secondary">
              Cancel
            </a>
          </div>
        </form>
      </div>
    </div>
</div>
{% endblock %}