{% extends "admin_layout.jinja" %}

{% block admin_content %}
<div class="bx--container">
  <div class="bx--grid">
    <div class="bx--row">
      <div class="bx--col">
        <nav aria-label="breadcrumb" class="bx--breadcrumb">
          <div class="bx--breadcrumb-item">
            <a href="/admin/supported-products/" class="bx--link">Supported Products</a>
          </div>
          <div class="bx--breadcrumb-item bx--breadcrumb-item--current">
            <span>{{ product.name }}</span>
          </div>
        </nav>

        <h1 class="bx--type-expressive-heading-05">{{ product.name }}</h1>

        <div class="bx--tile" style="margin-bottom: 2rem;">
          <div class="bx--row">
            <div class="bx--col-lg-6">
              <p><strong>Variant:</strong> {{ product.variant }}</p>
              <p><strong>Vendor:</strong> {{ product.vendor }}</p>
              {% if product.code %}
              <p><strong>Code:</strong> {{ product.code.code }}</p>
              {% endif %}
            </div>
            <div class="bx--col-lg-6">
              <p><strong>Created:</strong> {{ product.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
              {% if product.updated_at %}
              <p><strong>Updated:</strong> {{ product.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
              {% endif %}
              {% if product.eol_at %}
              <p><strong>End of Life:</strong> {{ product.eol_at.strftime('%Y-%m-%d') }}</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="bx--row">
      <div class="bx--col">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
          <h2 class="bx--type-productive-heading-04">Red Hat Mirrors ({{ product.rh_mirrors|length }})</h2>
          <a href="/admin/supported-products/{{ product.id }}/mirrors/new" class="bx--btn bx--btn--primary">
            Add Mirror
          </a>
        </div>

        {% if product.rh_mirrors %}
        <table class="bx--data-table bx--data-table--sticky-header">
          <thead>
            <tr>
              <th>
                <span class="bx--table-header-label">Name</span>
              </th>
              <th>
                <span class="bx--table-header-label">Match Variant</span>
              </th>
              <th>
                <span class="bx--table-header-label">Version</span>
              </th>
              <th>
                <span class="bx--table-header-label">Architecture</span>
              </th>
              <th>
                <span class="bx--table-header-label">Repositories</span>
              </th>
              <th>
                <span class="bx--table-header-label">Blocks</span>
              </th>
              <th>
                <span class="bx--table-header-label">Actions</span>
              </th>
            </tr>
          </thead>
          <tbody>
            {% for mirror in product.rh_mirrors %}
            <tr>
              <td>
                <a href="/admin/supported-products/{{ product.id }}/mirrors/{{ mirror.id }}" class="bx--link">
                  {{ mirror.name }}
                </a>
              </td>
              <td>{{ mirror.match_variant }}</td>
              <td>
                {{ mirror.match_major_version }}{% if mirror.match_minor_version %}.{{ mirror.match_minor_version }}{% endif %}
              </td>
              <td>{{ mirror.match_arch }}</td>
              <td>
                <span class="bx--tag bx--tag--blue">
                  {{ mirror.stats.repomds }} repos
                </span>
              </td>
              <td>
                <span class="bx--tag bx--tag--red">
                  {{ mirror.stats.blocks }} blocks
                </span>
              </td>
              <td>
                <div style="display: flex; gap: 0.5rem;">
                  <a href="/admin/supported-products/{{ product.id }}/mirrors/{{ mirror.id }}"
                     class="bx--btn bx--btn--ghost bx--btn--sm">
                    Manage
                  </a>
                  <form method="post" action="/admin/supported-products/{{ product.id }}/mirrors/{{ mirror.id }}/delete"
                        style="display: inline;"
                        onsubmit="return confirm('Are you sure you want to delete this mirror? This will also delete all associated repositories and blocks.')">
                    <button type="submit" class="bx--btn bx--btn--danger--ghost bx--btn--sm">
                      Delete
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="bx--tile">
          <p>No Red Hat mirrors configured for this product.</p>
          <a href="/admin/supported-products/{{ product.id }}/mirrors/new" class="bx--btn bx--btn--primary" style="margin-top: 1rem;">
            Add First Mirror
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}